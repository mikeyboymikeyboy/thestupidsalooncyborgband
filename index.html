
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>The Stupid Saloon Cyborg Band</title>
  <style>
    .button {
      padding: 10px 20px;
      margin: 1em;
      background: #3e2f23;
      color: #f4e7d0;
      border: 1px solid #a57c57;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="game">
    <div class="button" onclick="downloadComic()">ðŸ“„ Download Your Adventure Comic</div>
  </div>

  <div id="comicSvgWrapper" style="display:none;">
    <svg id="comicSVG" width="1000" height="1400" xmlns="http://www.w3.org/2000/svg">
      <image id="panel1" x="50" y="50" width="400" height="300" />
      <image id="panel2" x="500" y="50" width="400" height="300" />
      <image id="panel3" x="50" y="400" width="400" height="300" />
      <image id="panel4" x="500" y="400" width="400" height="300" />
      <image id="panel5" x="275" y="750" width="450" height="450" />
    </svg>
  </div>

  <script>
    let visitedImages = [
      "https://example.com/image1.png",
      "https://example.com/image2.png",
      "https://example.com/image3.png"
    ];

    window.downloadComic = async function downloadComic() {
      const svg = document.querySelector("#comicSvgWrapper svg");
      const panels = Array.from(svg.querySelectorAll("image[id^='panel']"));

      panels.forEach((panel, i) => {
        if (visitedImages[i]) {
          panel.setAttribute("href", visitedImages[i]);
        } else {
          panel.removeAttribute("href");
        }
      });

      const canvas = document.createElement("canvas");
      canvas.width = 2048;
      canvas.height = 2860;
      const ctx = canvas.getContext("2d");

      await canvg.Canvg.fromString(ctx, svg.outerHTML).render();

      const imgData = canvas.toDataURL("image/png");

      const pdfDoc = await PDFLib.PDFDocument.create();
      const img = await pdfDoc.embedPng(imgData);
      const page = pdfDoc.addPage([img.width, img.height]);
      page.drawImage(img, { x: 0, y: 0, width: img.width, height: img.height });

      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "your-adventure-comic.pdf";
      link.click();
    };
  </script>

  <script src="https://unpkg.com/pdf-lib"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvg@3.0.10/lib/umd.min.js"></script>
</body>
</html>
